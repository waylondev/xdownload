# XDownload - 跨平台下载工具

## 项目简介

XDownload 是一款基于 Rust + Tauri 开发的跨平台下载工具，支持音乐、视频等多种媒体类型的下载，具有高性能、低资源占用的特点。

## 技术栈

### 后端（Rust）

| 技术/库          | 用途                          | 版本要求   |
|------------------|-------------------------------|------------|
| **Tokio**        | 异步运行时                    | ^1.36.0    |
| **Reqwest**      | HTTP 客户端                   | ^0.11.24   |
| **Tokio::fs**    | 异步文件 I/O                  | 随 Tokio   |
| **Rusqlite**     | 本地数据库                    | ^0.30.0    |
| **Serde**        | 序列化/反序列化               | ^1.0.195   |
| **Tracing**      | 日志系统                      | ^0.1.40    |
| **Anyhow**       | 错误处理                      | ^1.0.79    |
| **Clap**         | 命令行参数解析                | ^4.4.18    |
| **Mime_guess**   | 媒体类型识别                  | ^2.0.4     |
| **Sha2**         | 文件哈希计算                  | ^0.10.8    |

### 前端（Tauri + React）

| 技术/库          | 用途                          | 版本要求   |
|------------------|-------------------------------|------------|
| **Tauri**        | 跨平台桌面框架                | ^2.0.0     |
| **React**        | UI 框架                       | ^18.2.0    |
| **Vite**         | 构建工具                      | ^5.0.0     |
| **TypeScript**   | 类型系统                      | ^5.3.0     |
| **Shadcn/ui**    | UI 组件库                     | ^2.0.0     |
| **Zustand**      | 状态管理                      | ^4.4.7     |
| **Tailwind CSS** | CSS 框架                      | ^3.4.0     |
| **TanStack Query** | 数据异步处理              | ^5.17.0    |
| **@tauri-apps/api** | Tauri API 封装        | ^2.0.0     |

## 架构设计

### 系统架构

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  前端界面层     │     │  Tauri 桥接层   │     │  后端服务层     │
│  React + TypeScript │<-->│  Tauri IPC      │<-->│  Rust 异步服务  │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                              ▲                       ▲
                              │                       │
                              ▼                       ▼
                        ┌─────────────┐         ┌─────────────┐
                        │  本地文件系统 │         │  SQLite 数据库 │
                        └─────────────┘         └─────────────┘
```

### 核心模块设计

#### 1. 下载核心模块
- 支持 HTTP/HTTPS 协议
- 异步多任务下载
- 断点续传
- 速度限制
- 自动重试机制

#### 2. 文件管理模块
- 自动文件类型识别
- 智能命名
- 文件分类管理
- 完整性校验

#### 3. 任务管理模块
- 任务队列
- 优先级调度
- 并发控制
- 任务状态持久化

#### 4. 前端界面模块
- 任务列表
- 实时进度显示
- 下载速度监控
- 历史记录管理
- 设置面板

## 开发计划

### 第一阶段：项目初始化与基础框架搭建

| 任务 | 预计时间 | 负责人 | 完成标准 |
|------|----------|--------|----------|
| 1. 创建 Rust 后端项目 | 1 天 | 后端 | Cargo.toml 配置完成，基础依赖添加 |
| 2. 初始化 Tauri + React 前端 | 1 天 | 前端 | Vite + Tauri 项目创建，基础页面 |
| 3. 设置开发环境与工具链 | 0.5 天 | 全组 | 所有成员环境配置完成，可正常构建 |
| 4. 实现前后端 IPC 通信 | 1 天 | 前后端 | 基本的数据传输测试通过 |

### 第二阶段：核心功能实现

| 任务 | 预计时间 | 负责人 | 完成标准 |
|------|----------|--------|----------|
| 5. 实现下载核心逻辑 | 3 天 | 后端 | 支持单文件下载，断点续传 |
| 6. 实现文件管理功能 | 2 天 | 后端 | 自动识别文件类型，智能命名 |
| 7. 实现 SQLite 数据库 | 1.5 天 | 后端 | 支持任务持久化，历史记录查询 |
| 8. 实现任务列表 UI | 2 天 | 前端 | 显示任务列表，实时进度 |
| 9. 实现添加下载任务功能 | 1 天 | 前端 | 支持 URL 输入，任务提交 |

### 第三阶段：高级功能与优化

| 任务 | 预计时间 | 负责人 | 完成标准 |
|------|----------|--------|----------|
| 10. 实现多任务并发下载 | 1.5 天 | 后端 | 支持多任务并行，可配置并发数 |
| 11. 实现速度限制功能 | 1 天 | 后端 | 支持全局和单任务速度限制 |
| 12. 实现下载历史管理 | 1 天 | 前端 | 支持历史记录查看、搜索、删除 |
| 13. 实现设置面板 | 1.5 天 | 前端 | 支持配置下载路径、并发数等 |
| 14. 优化前端界面样式 | 2 天 | 前端 | 现代化 UI 设计，响应式布局 |

### 第四阶段：测试与发布

| 任务 | 预计时间 | 负责人 | 完成标准 |
|------|----------|--------|----------|
| 15. 单元测试与集成测试 | 2 天 | 全组 | 测试覆盖率达到 80% 以上 |
| 16. 性能测试与优化 | 1.5 天 | 全组 | 大文件下载稳定，资源占用合理 |
| 17. 跨平台测试 | 1 天 | 全组 | Windows/macOS/Linux 均可正常运行 |
| 18. 打包与发布 | 1 天 | 全组 | 生成各平台安装包，文档完善 |

## 开发规范

### 代码规范

1. **Rust 代码规范**
   - 使用 `rustfmt` 进行代码格式化
   - 使用 `clippy` 进行代码质量检查
   - 遵循 Rust API Guidelines

2. **TypeScript 代码规范**
   - 使用 ESLint + Prettier 进行代码格式化
   - 严格遵循 TypeScript 最佳实践
   - 组件命名采用 PascalCase，函数命名采用 camelCase

### 提交规范

使用 Conventional Commits 规范，提交信息格式：

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

常用 type 包括：
- feat: 新功能
- fix: 修复 bug
- docs: 文档更新
- style: 代码风格调整
- refactor: 代码重构
- test: 测试相关
- build: 构建配置更新

## 目录结构

```
xdownload/
├── src-tauri/              # Tauri 后端代码
│   ├── src/               # Rust 源代码
│   │   ├── main.rs        # 入口文件
│   │   ├── download/      # 下载核心模块
│   │   ├── file/          # 文件管理模块
│   │   ├── db/            # 数据库模块
│   │   ├── ipc/           # IPC 通信模块
│   │   └── utils/         # 工具函数
│   ├── Cargo.toml         # Rust 依赖配置
│   └── tauri.conf.json    # Tauri 配置
├── src/                   # 前端代码
│   ├── App.tsx            # 主应用组件
│   ├── main.tsx           # 入口文件
│   ├── components/        # UI 组件
│   ├── hooks/             # 自定义 Hooks
│   ├── store/             # Zustand 状态管理
│   ├── services/          # API 服务
│   ├── types/             # TypeScript 类型定义
│   └── styles/            # 样式文件
├── public/                # 静态资源
├── index.html             # HTML 入口
├── package.json           # npm 依赖配置
├── vite.config.ts         # Vite 配置
├── tsconfig.json          # TypeScript 配置
└── README.md              # 项目文档
```

## 安装与开发

### 环境要求

- Rust 1.75.0+
- Node.js 18.0.0+
- npm 9.0.0+

### 开发流程

1. 克隆仓库

2. 安装依赖
   ```bash
   npm install
   ```

3. 启动开发服务器
   ```bash
   npm run tauri dev
   ```

4. 构建生产版本
   ```bash
   npm run tauri build
   ```

## 功能特性

- ✅ 支持 HTTP/HTTPS 协议下载
- ✅ 支持断点续传
- ✅ 支持多任务并发下载
- ✅ 自动文件类型识别和命名
- ✅ 实时下载进度显示
- ✅ 下载历史管理
- ✅ 速度限制
- ✅ 跨平台支持（Windows/macOS/Linux）

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系我们。